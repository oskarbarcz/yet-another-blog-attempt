---
import Layout from "../layouts/Layout.astro";
import Meta from "../components/shared/Meta.astro";
import { getCollection } from "astro:content";
import HomeHero from "../components/home/HomeHero";
import HomeLatestArticles from "../components/home/HomeLatestArticles";
import HomeLatestEvents from "../components/home/HomeLatestEvents";
import {
  HOMEPAGE_LATEST_COUNT,
  HOMEPAGE_DESCRIPTION,
  DEFAULT_SITE_TITLE,
} from "../constants";

const allArticles = await getCollection("articles");
const latestArticles = allArticles
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, HOMEPAGE_LATEST_COUNT)
  .map((article) => ({
    slug: article.slug,
    title: article.data.title,
    excerpt: article.data.excerpt,
    date: article.data.date.toISOString(),
    readTime: article.data.readTime,
    tags: article.data.tags,
    coverUrl: article.data.coverUrl,
  }));

const allEvents = await getCollection("events");
const latestEvents = allEvents
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, HOMEPAGE_LATEST_COUNT)
  .map((e) => ({
    title: e.data.title,
    role: e.data.role,
    date: e.data.date.toISOString(),
    city: e.data.city,
  }));
---

<Layout>
  <Fragment slot="title">{DEFAULT_SITE_TITLE}</Fragment>
  <Meta
    slot="head"
    title={DEFAULT_SITE_TITLE}
    description={HOMEPAGE_DESCRIPTION}
    keywords={[
      "architektura IT",
      "programowanie",
      "React",
      "Astro",
      "API",
      "bezpieczeÅ„stwo IT",
    ]}
  />
  <main>
    <HomeHero />
    <HomeLatestArticles articles={latestArticles} />
    <HomeLatestEvents events={latestEvents} />
  </main>
</Layout>
