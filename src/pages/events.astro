---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import Meta from "../components/shared/Meta.astro";
import EventTimeline from "../components/events/EventTimeline";
import PhotoSwipeInit from "../components/shared/PhotoSwipeInit";
import { EVENTS_PAGE_DESCRIPTION } from "../constants";

const allEvents = await getCollection("events");
const events = allEvents
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .map((e) => ({
    title: e.data.title,
    role: e.data.role,
    date: e.data.date.toISOString(),
    city: e.data.city,
    description: e.data.description,
    organizer: e.data.organizer,
    photos: e.data.photos ?? [],
    links: e.data.links ?? {},
  }));
---

<Layout>
  <Fragment slot="title">Wszystkie wydarzenia</Fragment>
  <Meta
    slot="head"
    title="Wszystkie wydarzenia"
    description={EVENTS_PAGE_DESCRIPTION}
    keywords={["wydarzenia", "konferencje", "panele dyskusyjne", "oskar barcz"]}
  />
  <main class="relative">
    <div
      class="relative mx-auto max-w-5xl px-4 pt-10 pb-16 sm:px-6 lg:px-8 lg:pt-16 lg:pb-24"
    >
      <header class="mb-8">
        <h1
          class="font-family-slab text-3xl font-bold tracking-tight text-gray-900 dark:text-white"
        >
          Wydarzenia
        </h1>
        <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
          {EVENTS_PAGE_DESCRIPTION}
        </p>
      </header>

      <section aria-label="Oś czasu wydarzeń">
        <EventTimeline events={events} />
      </section>
      <PhotoSwipeInit client:load />
    </div>
  </main>
</Layout>
