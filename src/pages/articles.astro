---
import { getCollection } from "astro:content";
import ArticlesList from "../components/ArticlesList";
import Meta from "../components/Meta.astro";
import Layout from "../layouts/Layout.astro";

// Fetch all articles from the content collection
const allArticles = await getCollection("articles");

// Sort articles by date (newest first) and transform data
const articles = allArticles
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .map((article) => ({
    slug: article.slug,
    title: article.data.title,
    excerpt: article.data.excerpt,
    date: article.data.date.toISOString(),
    readTime: article.data.readTime,
    tags: article.data.tags,
    coverUrl: article.data.coverUrl,
  }));
---

<Layout>
  <Fragment slot="title">Wszystkie publikacje</Fragment>
  <Meta
    slot="head"
    title="Wszystkie publikacje"
    description="Lista publikacji: architektura, wydajność, bezpieczeństwo API, React i Astro."
  />
  <ArticlesList articles={articles} client:load />
</Layout>
