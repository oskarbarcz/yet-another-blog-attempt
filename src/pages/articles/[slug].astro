---
import Layout from "../../layouts/Layout.astro";
import Meta from "../../components/shared/Meta.astro";
import ArticleTags from "../../components/articles/ArticleTags.tsx";
import AuthorSection from "../../components/articles/AuthorSection.tsx";
import PhotoSwipeInit from "../../components/shared/PhotoSwipeInit";
import type { CollectionEntry } from "astro:content";

interface Props {
  entry: CollectionEntry<"articles">;
}

export async function getStaticPaths() {
  const { getCollection } = await import("astro:content");
  const entries = await getCollection("articles");

  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props as Props;
const { Content } = await entry.render();
---

<Layout>
  <Fragment slot="title">{entry.data.title}</Fragment>
  <Meta
    slot="head"
    title={entry.data.title}
    description={entry.data.excerpt}
    type="article"
    publishedTime={entry.data.date.toISOString()}
    image={entry.data.coverUrl}
  />
  <main
    class="relative mx-auto max-w-5xl px-4 pt-10 pb-16 sm:px-6 lg:px-8 lg:pt-16 lg:pb-24"
  >
    <header class="mb-10">
      {
        entry.data.coverUrl && (
          <div class="mb-6 overflow-hidden rounded-xl bg-gray-100 dark:bg-gray-800">
            <img
              src={entry.data.coverUrl}
              alt={entry.data.title}
              class="h-64 w-full object-cover"
              loading="lazy"
              decoding="async"
            />
          </div>
        )
      }
      <nav class="mb-6">
        <a
          href="/articles"
          class="hover:text-brand-600 dark:hover:text-brand-400 inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400"
        >
          <span aria-hidden="true">←</span>
          Powrót do listy publikacji
        </a>
      </nav>
      <h1
        class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white"
      >
        {entry.data.title}
      </h1>
      <div
        class="mt-3 flex flex-wrap items-center gap-3 text-sm text-gray-600 dark:text-gray-400"
      >
        <time datetime={entry.data.date.toISOString()}>
          {
            entry.data.date.toLocaleDateString(undefined, {
              year: "numeric",
              month: "long",
              day: "numeric",
            })
          }
        </time>
        <span aria-hidden="true">•</span>
        <span>{entry.data.readTime}</span>
        {
          entry.data.tags?.length ? (
            <>
              <span aria-hidden="true">•</span>
              <ArticleTags
                client:load
                tags={entry.data.tags}
                limit={entry.data.tags.length}
              />
            </>
          ) : null
        }
      </div>
    </header>

    <PhotoSwipeInit client:load />

    <article class="article-content pswp-gallery overflow-auto wrap-break-word">
      <Content />
    </article>

    <AuthorSection />
  </main>
</Layout>
